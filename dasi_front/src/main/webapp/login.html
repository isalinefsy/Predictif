<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion</title>
    <link rel="stylesheet" type="text/css" href="css/common.css">
    <link rel="stylesheet" type="text/css" href="css/login.css">
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <h1>Predict'IF <img src="images/predict_if.png" alt="logo" class="logo-img"></h1>
            </div>
            <nav>
                <a href="index.html">Accueil</a>
                <a href="login.html">Se connecter</a>
                <a href="registerClient.html">Créer un compte</a>
            </nav>
        </div>
    </header>
    <div class="container">
        <div class="login-section">
            <div class="zodiac-images">
                <img src="images/belier.png" alt="Bélier">
                <img src="images/taureau.png" alt="Taureau">
                <img src="images/gemeau.png" alt="Gémeaux">
                <img src="images/cancer.png" alt="Cancer">
                <img src="images/lion.png" alt="Lion">
                <img src="images/virgo.png" alt="Vierge">
                <img src="images/balance.png" alt="Balance">
                <img src="images/scorpion.png" alt="Scorpion">
                <img src="images/sagittaire.png" alt="Sagittaire">
                <img src="images/capricorne.png" alt="Capricorne">
                <img src="images/poisson.png" alt="Verseau">
                <img src="images/poissons.png" alt="Poissons">
            </div>
            <h1>Connexion</h1>
            <form>
                <input type="email" id="champ-login" placeholder="Entrez votre adresse mail" required>
                <input type="password" id="champ-password" placeholder="Entrez votre mot de passe" required>
                <button type="submit" id="bouton-connexion">Valider</button>
            </form>
            <p id="notification"></p>
        </div>
    </div>
    <script>
        $(document).ready(function () {
            $('#bouton-connexion').on('click', function (e) {
                e.preventDefault();
                console.log("clic sur le bouton de connexion");
                $('#notification').html("Connexion...");
                var champLogin = $('#champ-login').val();
                var champPassword = $('#champ-password').val();
                $.ajax({
                    url: './ActionServlet',
                    method: 'POST',
                    data: {
                        todo: 'connecter',
                        login: champLogin,
                        password: champPassword
                    },
                    dataType: 'json'
                }).done(function (response) {
                    console.log('Response', response);
                    if (response.connexion && response.estClient) {
                        $('#notification').html("Connexion de " + response.utilisateur.prenom + " " + response.utilisateur.nom + " (ID " + response.utilisateur.id + ")");
                        window.location = "accueilClient.html";
                    } else if (response.connexion && !response.estClient) {
                        $('#notification').html("Connexion de " + response.utilisateur.prenom + " " + response.utilisateur.nom + " (ID " + response.utilisateur.id + ")");
                        window.location = "accueilEmploye.html";
                    } else {
                        $('#notification').html("Erreur de Connexion");
                    }
                }).fail(function (error) {
                    console.log('Error', error);
                    alert("Erreur lors de l'appel AJAX");
                    $('#notification').html("Erreur lors de la connexion.");
                }).always(function () {});
            });
        });
    </script>
</body>
</html>
